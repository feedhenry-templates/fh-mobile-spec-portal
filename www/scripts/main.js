function showErrorPanel(a){var b=$("<div>").addClass("panel panel-danger").append($("<div>").addClass("panel-heading").text("Error")).append($("<div>").addClass("panel-body").text(a));$(".results").empty().append(b)}function loadApp(){$fh.cloud({path:"/recordTest",method:"get",contentType:"application/json"},function(a){$(".spinner").remove();var b=new TestResults(a),c=$(".content")[0],d={removeActive:function(){$(".sidebar-nav li").removeClass("active")},makeActive:function(a){this.removeActive(),$(".sidebar-nav a[href="+a+"]").find("li").addClass("active")}},e=Backbone.Router.extend({routes:{about:"about",help:"help",results:"results",charts:"charts","*path":"default"},help:function(){var a=new HelpView({collection:b,el:c});a.render(),d.makeActive("#help")},about:function(){var a=new AboutView({collection:b,el:c});a.render(),d.makeActive("#about")},charts:function(){var a=new TestChartsView({collection:b,el:c});a.render(),d.makeActive("#charts")},results:function(){var a=new TestResultsView({collection:b,el:c});a.render(),d.makeActive("#results")},"default":function(){this.navigate("results",{trigger:!0})}}),f=new e;Backbone.history.start(),window.router=f},function(a){showErrorPanel("Failed to load test results. You should find out why. Error : "+a)})}var TestResult=Backbone.Model.extend({}),TestResults=Backbone.Collection.extend({model:TestResult,_colourForKey:function(a){if("win32nt"===a.toLowerCase())return"#fb9d00";if("blackberry"===a.toLowerCase())return"#df3f1f";if("ios"===a.toLowerCase())return"#666666";if("android"===a.toLowerCase())return"#7bb900";if("studio"===a.toLowerCase())return"#3d96ae";if("ipad"===a.toLowerCase())return"#aa4643";if("ios"===a.toLowerCase())return"#484848";if("embed"===a.toLowerCase())return"#4572a7";if("fhc"===a.toLowerCase())return"#492970";if("web"===a.toLowerCase())return"#92A8CD";if("mobile"===a.toLowerCase())return"#80699B";if(""===a.toLowerCase())return"#db843d";var b=["#aa4643","#80699b","#db843d","#4572A7","#AA4643","#89A54E","#3D96AE","#DB843D","#A47D7C","#B5CA92"],c=b[Math.floor(Math.random()*b.length)];return c},_filterDeviceInfo:function(a){var b={};this.each(function(c){var d=c.get("deviceInfo"),e=d[a];if(_.has(b,e)){var f=b[e];b[e]={value:f.value+=1,label:f.label}}else b[e]={value:1,label:e}},this);var c=[];return _.each(b,function(a,b){var d=this._colourForKey(b);c.push({value:a.value,label:b,color:d,highlight:d})},this),c},byOS:function(){return this._filterDeviceInfo("platform")},byCordova:function(){return this._filterDeviceInfo("cordova")},byDevice:function(){return this._filterDeviceInfo("model")}}),TestResultsView=Backbone.View.extend({template:"#results-template",render:function(){var a=this;console.log(this.collection.toJSON());var b=$(this.template).html();$(this.el).html(b);var c=a.$el.find("table"),d=c.dataTable({data:a.collection.toJSON(),paging:!0,pageLength:10,sDom:'<"top">rt<"bottom"lp><"clear">',columns:[{title:"Device",data:"deviceInfo.platform"},{title:"OS Version",data:"deviceInfo.version"},{title:"UUID",data:"deviceInfo.uuid"},{title:"Device Model",data:"deviceInfo.model"},{title:"Cordova Version",data:"deviceInfo.cordova"},{title:"Test Time",data:function(a){var b=a.testInfo,c=_.findWhere(b,{stage:"runner_starting"});if(c){var d=c.ts;return moment(d).fromNow()}return"Unknown"}},{title:"Test Results (Failed/Total)",data:function(a){var b=a.testInfo,c=_.findWhere(b,{stage:"complete"});if(c){var d=c.data.failed_specs+"/"+c.data.total_specs;return d}return"Not Completed"}}]});$("input.search").on("keyup",function(a){var b=$(a.currentTarget).val();d.fnFilter(b)})}}),TestChartsView=Backbone.View.extend({template:"#charts-template",render:function(){var a=$(this.template).html();$(this.el).html(a),this.renderOS(),this.renderCordova(),this.renderDevice()},renderOS:function(){{var a=this.$el.find("#os"),b=this.collection.byOS(),c=a.get(0).getContext("2d");new Chart(c).Doughnut(b,this.doughnutOptions)}},renderCordova:function(){{var a=this.$el.find("#cordova_version"),b=this.collection.byCordova(),c=a.get(0).getContext("2d");new Chart(c).Doughnut(b,this.doughnutOptions)}},renderDevice:function(){{var a=this.$el.find("#model"),b=this.collection.byDevice(),c=a.get(0).getContext("2d");new Chart(c).Doughnut(b,this.doughnutOptions)}}}),AboutView=Backbone.View.extend({template:"#about-template",render:function(){var a=$(this.template).html();$(this.el).html(a)}}),HelpView=Backbone.View.extend({template:"#help-template",render:function(){var a=$(this.template).html();$(this.el).html(a)}}),initcalled=!1;$(document).ready(function(){$(".spinner").spin(),$fh.on("fhinit",function(a){initcalled=!0,a?showErrorPanel("FH SDK failed to init. Something is wrong..."):loadApp()}),setTimeout(function(){initcalled||showErrorPanel("FH SDK failed to init in 5 seconds. You should find out why...")},5e3)});